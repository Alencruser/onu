"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var CARDS_PER_PLAYER=7,NUMBER_OF_DRAW_TWO=2,NUMBER_OF_REVERSE=2,NUMBER_OF_SKIP=2,NUMBER_OF_WILD=4,NUMBER_OF_WILD_DRAW_FOUR=4,Color={RED:1,BLUE:2,GREEN:3,YELLOW:4},colors=[Color.RED,Color.BLUE,Color.GREEN,Color.YELLOW],Value={ZERO:0,ONE:1,TWO:2,THREE:3,FOUR:4,FIVE:5,SIX:6,SEVEN:7,EIGHT:8,NINE:9,DRAW_TWO:10,REVERSE:11,SKIP:12,WILD:13,WILD_DRAW_FOUR:14,DECKEPTION:15},values=[Value.ZERO,Value.ONE,Value.TWO,Value.THREE,Value.FOUR,Value.FIVE,Value.SIX,Value.SEVEN,Value.EIGHT,Value.NINE,Value.DRAW_TWO,Value.REVERSE,Value.SKIP,Value.WILD,Value.WILD_DRAW_FOUR,Value.DECKEPTION];function isWild(e){return e===Value.WILD||e===Value.WILD_DRAW_FOUR}var GameDirection={CLOCKWISE:1,COUNTER_CLOCKWISE:2},Card=function(){function r(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,r),this.color=t,this.value=e}return _createClass(r,[{key:"isWildCard",value:function(){return isWild(this.value)}},{key:"isSpecialCard",value:function(){return this.isWildCard()||this.value===Value.DRAW_TWO||this.value===Value.REVERSE||this.value===Value.SKIP}},{key:"matches",value:function(e){return!!this.isWildCard()||(e._value==this.value||e._color==this.color)}},{key:"is",value:function(e,t){var r=1<arguments.length&&void 0!==t?t:null,a=this.value==e;return r&&(a=a&&this.color==r),a}},{key:"value",get:function(){return this._value},set:function(e){this._value=e}},{key:"color",get:function(){return this._color},set:function(e){this._color=e}}]),r}();function createUnoDeck(){function r(e,t,r){for(var a=2<arguments.length&&void 0!==r?r:null,i=[],s=0;s<e;s++)i.push(new Card(t,a));return i}var a=[];return colors.forEach(function(e){a.push.apply(a,r(1,Value.ZERO,e));for(var t=Value.ONE;t<=Value.NINE;t++)a.push.apply(a,r(2,t,e));a.push.apply(a,r(NUMBER_OF_DRAW_TWO,Value.DRAW_TWO,e)),a.push.apply(a,r(NUMBER_OF_SKIP,Value.SKIP,e)),a.push.apply(a,r(NUMBER_OF_REVERSE,Value.REVERSE,e))}),a.push.apply(a,r(NUMBER_OF_WILD,Value.WILD)),a.push.apply(a,r(NUMBER_OF_WILD_DRAW_FOUR,Value.WILD_DRAW_FOUR)),a}var Deck=function(){function a(){_classCallCheck(this,a),_defineProperty(this,"drawpile",[]),this.drawpile=createUnoDeck();for(var e,t=Object.keys(this.drawpile).length;t;){e=Math.floor(Math.random()*t--);var r=[this.drawpile[e],this.drawpile[t]];this.drawpile[t]=r[0],this.drawpile[e]=r[1]}}return _createClass(a,[{key:"draw",value:function(e){for(var t,r=0<arguments.length&&void 0!==e?e:1,a=[],i=0;i<r;i++)t=this.drawpile[0],this.drawpile.shift(),a.push(t);return a}},{key:"length",get:function(){return Object.keys(this.drawpile).length}}]),a}(),Player=function(){function t(e){_classCallCheck(this,t),_defineProperty(this,"hand",[]),_defineProperty(this,"_pos",void 0),this._pos=e}return _createClass(t,[{key:"getCardByValue",value:function(t){if(t)return this.hand.find(function(e){return e.value==t})}},{key:"hasCard",value:function(t){return!!t&&this.hand.some(function(e){return e.value==t.value&&e.color==t.color})}},{key:"hasPlayable",value:function(t){return!!t&&this.hand.some(function(e){return e._value==t._value||e._color==t._color||12<e._value})}},{key:"hasPlayableDodgeDraw",value:function(t){return!!t&&this.hand.some(function(e){return e._value==t._value||e._value==Value.WILD_DRAW_FOUR})}},{key:"removeCard",value:function(r){var a,e=this.hand.slice();return this.hand.map(function(e,t){e._color==r._color&&e._value==r._value&&(a=t)}),e.splice(a,1),this.hand=e}},{key:"pos",get:function(){return this._pos}},{key:"length",get:function(){return Object.keys(this.hand).length}}]),t}(),Game=function(){function a(e,t){_classCallCheck(this,a),_defineProperty(this,"_price",void 0),_defineProperty(this,"drawPile",void 0),_defineProperty(this,"direction",void 0),_defineProperty(this,"_currentPlayer",void 0),_defineProperty(this,"_discardedCard",void 0),_defineProperty(this,"_players",[]),_defineProperty(this,"hasdrawn",!1),_defineProperty(this,"NUMBER_OF_PLAYER",void 0),_defineProperty(this,"cumulativeamount",0),_defineProperty(this,"round",0),_defineProperty(this,"choice",1),_defineProperty(this,"optionZero",!0),_defineProperty(this,"optionSpeed",!0),this.NUMBER_OF_PLAYER=e,this._price=t;for(var r=0;r<e;r++)this._players.push(new Player(r));this.newGame()}return _createClass(a,[{key:"newGame",value:function(){var t=this;for(this.drawPile=new Deck,this.direction=GameDirection.CLOCKWISE,this._players.forEach(function(e){return e.hand=t.drawPile.draw(CARDS_PER_PLAYER).sort(function(e,t){return e.value+15*e.color>15*t.color+t.value?1:-1})});this._discardedCard=this.drawPile.draw()[0],this._discardedCard.isSpecialCard()&&this.drawPile.drawpile.push(this._discardedCard),this._discardedCard.isSpecialCard(););this._currentPlayer=this._players[Math.floor(Math.random()*this._players.length)]}},{key:"reverseGame",value:function(){this.direction=this.direction==GameDirection.CLOCKWISE?GameDirection.COUNTER_CLOCKWISE:GameDirection.CLOCKWISE}},{key:"getNextPlayer",value:function(e){0<arguments.length&&void 0!==e||this._currentPlayer._pos;var t=this._currentPlayer._pos;return this.direction==GameDirection.CLOCKWISE?++t>=this.NUMBER_OF_PLAYER&&(t=0):-1==--t&&(t=this.NUMBER_OF_PLAYER-1),this._players[t]}},{key:"getPlayerIndex",value:function(e){return this._players.map(function(e){return e._pos}).indexOf(e)}},{key:"pass",value:function(){this.goToNextPlayer()}},{key:"goToNextPlayer",value:function(){this.drawn=!1,this._currentPlayer=this.getNextPlayer(),this.candraw()}},{key:"goToNextPlayerLeave",value:function(e){this.drawn=!1,this._currentPlayer=this.getNextPlayer(e),this.candraw()}},{key:"candraw",value:function(){this._currentPlayer.hasPlayable(this._discardedCard)||(this.privateDraw(this._currentPlayer,1),0==this.round&&(this._players[this._currentPlayer._pos].hand=this._currentPlayer.hand)),this._currentPlayer.hasPlayable(this._discardedCard)||setTimeout(this.waitingRoom(),1e3)}},{key:"waitingRoom",value:function(){this.goToNextPlayer()}},{key:"play",value:function(e){var r=this,t=this._currentPlayer;if(new Card(e.value,e.color).matches(this._discardedCard)&&!(0<this.cumulativeamount&&e._value!=this._discardedCard._value&&e._value!=Value.WILD_DRAW_FOUR)&&(this._currentPlayer.removeCard(e),0==this.round&&(this._players[this._currentPlayer._pos].hand=this._currentPlayer.hand),this._discardedCard._value!=Value.WILD&&this._discardedCard._value!=Value.WILD_DRAW_FOUR||(this._discardedCard._color=null),this.drawPile.drawpile.push(this._discardedCard),this._discardedCard=e,0!=t.hand.length)){switch(this._discardedCard.value){case Value.WILD_DRAW_FOUR:this.choice=0,document.getElementById("siege0").dataset.pos==this._currentPlayer._pos&&$("#changeColor").modal("show"),this.getNextPlayer().hasPlayableDodgeDraw(this._discardedCard)?this.cumulativeamount+=4:(this.privateDraw(this.getNextPlayer(),this.cumulativeamount+4),this.cumulativeamount=0,this._currentPlayer=this.getNextPlayer());break;case Value.WILD:this.choice=0,document.getElementById("siege0").dataset.pos==this._currentPlayer._pos&&$("#changeColor").modal("show");break;case Value.DRAW_TWO:this.getNextPlayer().hasPlayableDodgeDraw(this._discardedCard)?this.cumulativeamount+=2:(this.privateDraw(this.getNextPlayer(),this.cumulativeamount+2),this.cumulativeamount=0,this.goToNextPlayer());break;case Value.SKIP:this._currentPlayer=this.getNextPlayer();break;case Value.REVERSE:2<this.NUMBER_OF_PLAYER?this.reverseGame():this._currentPlayer=this.getNextPlayer();break;case Value.ZERO:if(1==this.optionZero)if(this.direction==GameDirection.CLOCKWISE)for(var a=this._players[this.NUMBER_OF_PLAYER-1].hand,i=1;i<=this.NUMBER_OF_PLAYER;i++)i==this.NUMBER_OF_PLAYER?this._players[0].hand=a:this._players[i].hand=this._players[i-1].hand;else for(var s=this._players[0].hand,n=this.NUMBER_OF_PLAYER-1;0<=n;n--)0==n?this._players[this.NUMBER_OF_PLAYER-1].hand=s:this._players[n-1].hand=this._players[n].hand}this.choice&&(this.goToNextPlayer(),this.round++,this._players.map(function(e,t){r._players[t].hand.sort(function(e,t){return e.value+15*e.color>15*t.color+t.value?1:-1})}))}}},{key:"privateDraw",value:function(e,t){var r=this.drawPile.draw(t);e.hand=e.hand.concat(r).sort(function(e,t){return e.value+15*e.color>15*t.color+t.value?1:-1}),this.drawn=!0}},{key:"voluntaryDraw",value:function(){this.drawn=!0;var e=this.drawPile.draw();this._currentPlayer.hand=this._currentPlayer.hand.concat(e).sort(function(e,t){return e.value+15*e.color>15*t.color+t.value?1:-1}),e.matches(this._discardedCard)||this.goToNextPlayer()}},{key:"playerLeave",value:function(e){var t=!1;this._players[e]._pos==this._currentPlayer._pos&&(t=!0);for(var r=0;r<this.NUMBER_OF_PLAYER;r++)this._players[r]._pos>e&&--this._players[r]._pos;this._players.splice(e,1),--this.NUMBER_OF_PLAYER,t&&(this.goToNextPlayerLeave(e),t=!1)}},{key:"uno",value:function(e){this.privateDraw(this._players[e],2)}},{key:"currentPlayer",get:function(){return this._currentPlayer}},{key:"discardedCard",get:function(){return this._discardedCard}},{key:"players",get:function(){return this._players}},{key:"nextPlayer",get:function(){return this.getNextPlayer()}},{key:"deck",get:function(){return this.drawPile}},{key:"playingDirection",get:function(){return this.direction},set:function(e){e!==this.direction&&this.reverseGame()}}]),a}();